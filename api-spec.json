{"openapi":"3.1.0","info":{"title":"Admin API","description":"Platform administration API powered by platform-libs","version":"1.0.0"},"paths":{"/health":{"get":{"tags":["health"],"summary":"Health","description":"Health check endpoint.\n\nReturns:\n    Health status.","operationId":"health_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Health Health Get"}}}}}}},"/ready":{"get":{"tags":["health"],"summary":"Ready","description":"Readiness check endpoint.\n\nReturns:\n    Readiness status.","operationId":"ready_ready_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"additionalProperties":true,"type":"object","title":"Response Ready Ready Get"}}}}}}},"/api/v1/auth/refresh":{"post":{"tags":["auth"],"summary":"Refresh Token","description":"Refresh access token using refresh token.\n\nProxies the token refresh request to the IdP.","operationId":"refresh_token_api_v1_auth_refresh_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefreshTokenRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TokenResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/auth/logout":{"post":{"tags":["auth"],"summary":"Logout","description":"Logout and revoke refresh token.\n\nRevokes the refresh token at the IdP, invalidating the session.","operationId":"logout_api_v1_auth_logout_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LogoutRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/LogoutResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/auth/introspect":{"post":{"tags":["auth"],"summary":"Introspect Token","description":"Introspect current access token.\n\nReturns token validity and claims from the request context.\nThis does NOT call the IdP - it uses the already-validated token\nfrom the authentication middleware.\n\nFor actual IdP introspection, use /introspect-remote (requires client_secret).","operationId":"introspect_token_api_v1_auth_introspect_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/IntrospectionResponse"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/auth/userinfo":{"get":{"tags":["auth"],"summary":"Userinfo","description":"Get user profile from IdP.\n\nProxies the userinfo request to the IdP using the current access token.","operationId":"userinfo_api_v1_auth_userinfo_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserInfoResponse"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/auth/login":{"post":{"tags":["auth"],"summary":"Login","description":"Authenticate user with Direct Access Grant.\n\nReturns tokens and complete user profile including roles and permissions.\nThis endpoint uses the Resource Owner Password Credentials flow, which\nshould only be used by first-party applications.\n\nSecurity Considerations:\n- Rate limiting should be applied (5 attempts/minute per IP recommended)\n- Account lockout is handled by the IdP after failed attempts\n- All login attempts are audit logged\n- HTTPS required in production","operationId":"login_api_v1_auth_login_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LoginRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserProfileResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/auth/me":{"get":{"tags":["auth"],"summary":"Get Current User","description":"Get current authenticated user's complete profile.\n\nReturns the same data structure as the login response but without tokens.\nRequires a valid access token in the Authorization header.\n\nThe response includes:\n- User identity from IdP (sub, email, name, etc.)\n- Platform-specific data (principal_id, tenant_id)\n- Roles from IdP and permissions from authorization engine","operationId":"get_current_user_api_v1_auth_me_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserProfileResponse"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/auth/register":{"post":{"tags":["auth"],"summary":"Register User","description":"Register a new user.\n\nCreates a user in the IdP (Keycloak) with the provided credentials.\nEmail verification is required before the user can log in.\n\nSecurity Considerations:\n- Password must meet HIPAA-compliant policy (12+ chars, mixed case, numbers, special)\n- Rate limiting should be applied (3 attempts/minute per IP recommended)\n- All registration attempts are audit logged\n- Duplicate email/username returns 409 Conflict","operationId":"register_user_api_v1_auth_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RegisterResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/authz/me/permissions":{"get":{"tags":["Authorization"],"summary":"Get My Permissions","description":"Get current user's effective permissions.\n\nReturns the authenticated user's:\n- Realm roles (from IdP token)\n- Database roles (assigned in this tenant)\n- Effective permissions (from roles + direct grants)\n\nThis endpoint helps frontends build permission-aware UIs by providing\nall authorization information for the current user in one call.\n\nSecurity: Requires authentication. Returns only the requesting user's\nown permissions (cannot query other users' permissions).","operationId":"get_my_permissions_api_v1_authz_me_permissions_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/MyPermissionsResponse"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/authz/check":{"post":{"tags":["Authorization"],"summary":"Check Authorization","description":"Check if user can perform an action on a resource.\n\nADR-SEC-004: Includes app_id and policy_version in authorization request\nfor proper app-scoped caching.\n\nEvaluates authorization using the Decision API, which implements\nthe full authorization chain: ACL → RBAC → ABAC (where configured).\n\nThis endpoint is the frontend-facing interface to Layer 3 (Permission Level)\nof the three-layer security model.\n\nUse Cases:\n- Check before showing action buttons (e.g., \"can I delete this study?\")\n- Check before initiating expensive operations\n- Progressive disclosure of UI features based on permissions\n\nSecurity: Requires authentication. Only checks permissions for the\nauthenticated user - cannot check other users' permissions.","operationId":"check_authorization_api_v1_authz_check_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthzCheckRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthzCheckResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/authz/check/bulk":{"post":{"tags":["Authorization"],"summary":"Bulk Check Authorization","description":"Check multiple authorizations in a single request.\n\nADR-SEC-004: Includes app_id and policy_version for all checks.\n\nEfficiently checks multiple resource/action combinations for the\ncurrent user. Results are returned in the same order as requests.\n\nUse Cases:\n- Initial page load: check all possible actions for multiple resources\n- List views: check permissions for each item in a table\n- Reduce API round trips for permission checks\n\nLimits:\n- Maximum 100 checks per request\n- All checks use the same principal (current user)","operationId":"bulk_check_authorization_api_v1_authz_check_bulk_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BulkAuthzCheckRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BulkAuthzCheckResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/tenants":{"get":{"tags":["Tenant Management"],"summary":"List Tenants","description":"List all tenants with pagination, search and filtering (Super Admin only).\n\nFiltering:\n- **search**: Full-text search across name AND slug (OR logic)\n- **status**: Filter by tenant status (active, suspended, pending_deletion)\n\nSorting:\n- **sort_by**: name, slug, created_at, status (default: name)\n- **sort_order**: asc or desc (default: asc)\n\nReturns paginated results with total count for UI pagination.","operationId":"list_tenants_api_v1_tenants_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":1000,"minimum":1,"description":"Items per page","default":100,"title":"Limit"},"description":"Items per page"},{"name":"offset","in":"query","required":false,"schema":{"type":"integer","minimum":0,"description":"Pagination offset","default":0,"title":"Offset"},"description":"Pagination offset"},{"name":"search","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Full-text search across name and slug","title":"Search"},"description":"Full-text search across name and slug"},{"name":"status","in":"query","required":false,"schema":{"anyOf":[{"type":"string","pattern":"^(active|suspended|pending_deletion)$"},{"type":"null"}],"description":"Filter by status: active, suspended, pending_deletion","title":"Status"},"description":"Filter by status: active, suspended, pending_deletion"},{"name":"sort_by","in":"query","required":false,"schema":{"anyOf":[{"type":"string","pattern":"^(name|slug|created_at|status)$"},{"type":"null"}],"description":"Sort field: name, slug, created_at, status","default":"name","title":"Sort By"},"description":"Sort field: name, slug, created_at, status"},{"name":"sort_order","in":"query","required":false,"schema":{"anyOf":[{"type":"string","pattern":"^(asc|desc)$"},{"type":"null"}],"description":"Sort order: asc, desc","default":"asc","title":"Sort Order"},"description":"Sort order: asc, desc"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaginatedTenantsResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]},"post":{"tags":["Tenant Management"],"summary":"Create Tenant","description":"Create a new tenant (Super Admin only).","operationId":"create_tenant_api_v1_tenants_post","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TenantCreate"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TenantResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/tenants/{tenant_id}":{"get":{"tags":["Tenant Management"],"summary":"Get Tenant","description":"Get tenant by ID (Super Admin only).","operationId":"get_tenant_api_v1_tenants__tenant_id__get","parameters":[{"name":"tenant_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Tenant Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TenantResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]},"patch":{"tags":["Tenant Management"],"summary":"Update Tenant","description":"Update a tenant (Super Admin only).","operationId":"update_tenant_api_v1_tenants__tenant_id__patch","parameters":[{"name":"tenant_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Tenant Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TenantUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TenantResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]},"delete":{"tags":["Tenant Management"],"summary":"Delete Tenant","description":"Soft delete a tenant (Super Admin only).","operationId":"delete_tenant_api_v1_tenants__tenant_id__delete","parameters":[{"name":"tenant_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Tenant Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/tenants/{tenant_id}/suspend":{"post":{"tags":["Tenant Management"],"summary":"Suspend Tenant","description":"Suspend a tenant (Super Admin only).","operationId":"suspend_tenant_api_v1_tenants__tenant_id__suspend_post","parameters":[{"name":"tenant_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Tenant Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TenantResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/tenants/{tenant_id}/activate":{"post":{"tags":["Tenant Management"],"summary":"Activate Tenant","description":"Activate a suspended tenant (Super Admin only).","operationId":"activate_tenant_api_v1_tenants__tenant_id__activate_post","parameters":[{"name":"tenant_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Tenant Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TenantResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/users":{"get":{"tags":["User Management"],"summary":"List Users","description":"List users with pagination, filtering and sorting.\n\nAccess control:\n- **Super Admin**: Can list ALL users or filter by tenant_id query param\n- **Tenant Admin**: Lists users in current tenant (from header or tenant_id param)\n\nFiltering:\n- **search**: Full-text search across email AND name (OR logic)\n- **email**: Filter by email (partial match)\n- **name**: Filter by name (partial match)\n\nSorting:\n- **sort_by**: email, name, created_at, last_seen_at\n- **sort_order**: asc or desc (default: desc)","operationId":"list_users_api_v1_users_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":1000,"minimum":1,"description":"Items per page","default":100,"title":"Limit"},"description":"Items per page"},{"name":"offset","in":"query","required":false,"schema":{"type":"integer","minimum":0,"description":"Pagination offset","default":0,"title":"Offset"},"description":"Pagination offset"},{"name":"search","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Full-text search across email and name","title":"Search"},"description":"Full-text search across email and name"},{"name":"email","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by email (partial match)","title":"Email"},"description":"Filter by email (partial match)"},{"name":"name","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by display name (partial match)","title":"Name"},"description":"Filter by display name (partial match)"},{"name":"sort_by","in":"query","required":false,"schema":{"anyOf":[{"type":"string","pattern":"^(email|name|created_at|last_seen_at)$"},{"type":"null"}],"description":"Sort field: email, name, created_at, last_seen_at","default":"created_at","title":"Sort By"},"description":"Sort field: email, name, created_at, last_seen_at"},{"name":"sort_order","in":"query","required":false,"schema":{"anyOf":[{"type":"string","pattern":"^(asc|desc)$"},{"type":"null"}],"description":"Sort order: asc, desc","default":"desc","title":"Sort Order"},"description":"Sort order: asc, desc"},{"name":"tenant_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"description":"Filter by tenant ID. If not provided: super_admin sees all, tenant_admin uses header.","title":"Tenant Id"},"description":"Filter by tenant ID. If not provided: super_admin sees all, tenant_admin uses header."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaginatedUsersResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]},"post":{"tags":["User Management"],"summary":"Create User","description":"Create a new user in Keycloak and database.\n\nWhen Keycloak admin is available:\n- Creates user in Keycloak with password\n- Creates identity mapping in database with Keycloak's subject ID\n- Optionally assigns tenant role\n\nWhen Keycloak admin is NOT available (fallback):\n- Requires idp_issuer and idp_subject in request\n- Only creates identity mapping in database","operationId":"create_user_api_v1_users_post","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreate"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserDetailResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/users/{principal_id}":{"get":{"tags":["User Management"],"summary":"Get User","description":"Get user by principal ID.","operationId":"get_user_api_v1_users__principal_id__get","parameters":[{"name":"principal_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Principal Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]},"patch":{"tags":["User Management"],"summary":"Update User","description":"Update user details in both Keycloak and database.\n\nUpdates email, first_name, last_name, name, enabled status.\nOnly updates fields that are provided in the request.","operationId":"update_user_api_v1_users__principal_id__patch","parameters":[{"name":"principal_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Principal Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserDetailResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]},"delete":{"tags":["User Management"],"summary":"Delete User","description":"Delete or disable a user in both Keycloak and database.\n\nBy default (hard_delete=False):\n- Disables user in Keycloak (if available)\n- Removes user's role assignments in current tenant\n- Keeps identity mapping in DB for audit trail\n\nWith hard_delete=True:\n- Deletes user from Keycloak\n- Removes all role assignments across all tenants\n- Removes identity mapping from DB","operationId":"delete_user_api_v1_users__principal_id__delete","parameters":[{"name":"principal_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Principal Id"}},{"name":"hard_delete","in":"query","required":false,"schema":{"type":"boolean","description":"If true, delete from Keycloak. Otherwise just disable.","default":false,"title":"Hard Delete"},"description":"If true, delete from Keycloak. Otherwise just disable."}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/users/{principal_id}/roles":{"get":{"tags":["User Management"],"summary":"Get User Roles","description":"Get roles assigned to a user in current tenant.\n\nReturns a wrapped response with:\n- **principal_id**: Confirms which user's roles are returned\n- **roles**: List of role details\n- **count**: Number of roles assigned (useful for UI badges)","operationId":"get_user_roles_api_v1_users__principal_id__roles_get","parameters":[{"name":"principal_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Principal Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserRolesResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/roles":{"get":{"tags":["Role Management"],"summary":"List Roles","description":"List roles with pagination, filtering and sorting.\n\nAccess control:\n- **Super Admin**: Can list ALL roles or filter by tenant_id query param\n- **Tenant Admin**: Lists roles in current tenant (from header or tenant_id param)\n\nFiltering:\n- **search**: Full-text search across name AND description (OR logic)\n- **name**: Filter by name (partial match)\n- **is_system**: Filter system roles (true) or custom roles (false)\n\nSorting:\n- **sort_by**: name, created_at, updated_at (default: name)\n- **sort_order**: asc or desc (default: asc)\n\nOptions:\n- **include_permissions**: Include permissions list for each role","operationId":"list_roles_api_v1_roles_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":1000,"minimum":1,"description":"Items per page","default":100,"title":"Limit"},"description":"Items per page"},{"name":"offset","in":"query","required":false,"schema":{"type":"integer","minimum":0,"description":"Pagination offset","default":0,"title":"Offset"},"description":"Pagination offset"},{"name":"search","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Full-text search across name and description","title":"Search"},"description":"Full-text search across name and description"},{"name":"name","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by role name (partial match)","title":"Name"},"description":"Filter by role name (partial match)"},{"name":"is_system","in":"query","required":false,"schema":{"anyOf":[{"type":"boolean"},{"type":"null"}],"description":"Filter by system role flag","title":"Is System"},"description":"Filter by system role flag"},{"name":"sort_by","in":"query","required":false,"schema":{"anyOf":[{"type":"string","pattern":"^(name|created_at|updated_at)$"},{"type":"null"}],"description":"Sort field: name, created_at, updated_at","default":"name","title":"Sort By"},"description":"Sort field: name, created_at, updated_at"},{"name":"sort_order","in":"query","required":false,"schema":{"anyOf":[{"type":"string","pattern":"^(asc|desc)$"},{"type":"null"}],"description":"Sort order: asc, desc","default":"asc","title":"Sort Order"},"description":"Sort order: asc, desc"},{"name":"tenant_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"description":"Filter by tenant ID. If not provided: super_admin sees all, tenant_admin uses header.","title":"Tenant Id"},"description":"Filter by tenant ID. If not provided: super_admin sees all, tenant_admin uses header."},{"name":"include_permissions","in":"query","required":false,"schema":{"type":"boolean","description":"Include permissions for each role. Returns permission_key list per role.","default":false,"title":"Include Permissions"},"description":"Include permissions for each role. Returns permission_key list per role."}],"responses":{"200":{"description":"List of roles","content":{"application/json":{"schema":{"anyOf":[{"$ref":"#/components/schemas/PaginatedRolesResponse"},{"$ref":"#/components/schemas/PaginatedRolesWithPermissionsResponse"}],"title":"Response List Roles Api V1 Roles Get"},"examples":{"without_permissions":{"summary":"Roles without permissions (default)","value":{"items":[],"total":0,"limit":100,"offset":0,"has_more":false}},"with_permissions":{"summary":"Roles with permissions (include_permissions=true)","value":{"items":[{"permissions":[],"permission_count":0}],"total":1,"limit":100,"offset":0,"has_more":false}}}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]},"post":{"tags":["Role Management"],"summary":"Create Role","description":"Create a new role in current tenant.","operationId":"create_role_api_v1_roles_post","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RoleCreate"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RoleResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/roles/hierarchy":{"get":{"tags":["Role Management"],"summary":"Get Role Hierarchy","description":"Get role hierarchy visualization for current tenant.\n\nReturns a tree structure of roles showing parent-child relationships.\nRoot roles (no parent) are at depth 0.","operationId":"get_role_hierarchy_api_v1_roles_hierarchy_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/RoleHierarchyNode"},"type":"array","title":"Response Get Role Hierarchy Api V1 Roles Hierarchy Get"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/roles/{role_id}":{"get":{"tags":["Role Management"],"summary":"Get Role","description":"Get role by ID.","operationId":"get_role_api_v1_roles__role_id__get","parameters":[{"name":"role_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Role Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RoleResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]},"patch":{"tags":["Role Management"],"summary":"Update Role","description":"Update a role.","operationId":"update_role_api_v1_roles__role_id__patch","parameters":[{"name":"role_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Role Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RoleUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RoleResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]},"delete":{"tags":["Role Management"],"summary":"Delete Role","description":"Delete a role (soft delete).\n\nProduction-grade protection:\n- System roles cannot be deleted\n- Roles with assigned users require force=true\n- Soft delete preserves audit trail","operationId":"delete_role_api_v1_roles__role_id__delete","parameters":[{"name":"role_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Role Id"}},{"name":"force","in":"query","required":false,"schema":{"type":"boolean","description":"Force delete even if users are assigned","default":false,"title":"Force"},"description":"Force delete even if users are assigned"}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/roles/{role_id}/assignments":{"post":{"tags":["Role Management"],"summary":"Assign Role","description":"Assign a role to a user.\n\nADR-SEC-004: Supports app-scoped and tenant-wide grants.\n\n**App-scoped grant** (recommended):\n- Provide app_id to constrain the role to a specific application\n- Example: Grant \"Radiologist\" role only for the PACS Viewer app\n\n**Tenant-wide grant** (elevated access):\n- Set is_tenant_wide=True and provide grant_reason (≥10 chars)\n- Requires acknowledgment of the privilege-creep risk\n- Example: Grant \"PACS Admin\" role across all apps for MSP access","operationId":"assign_role_api_v1_roles__role_id__assignments_post","parameters":[{"name":"role_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Role Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RoleAssignmentCreate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RoleAssignmentResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/roles/{role_id}/assignments/{principal_id}":{"delete":{"tags":["Role Management"],"summary":"Revoke Role","description":"Revoke a role from a user (ADR-SEC-004).\n\nSupports app-scoped revocation:\n- No parameters: Revokes ALL grants for this role/principal combination\n- app_id=UUID: Revokes only the app-scoped grant\n- tenant_wide_only=true: Revokes only the tenant-wide grant\n\nExamples:\n- DELETE .../assignments/{principal_id} → Revoke all grants\n- DELETE .../assignments/{principal_id}?app_id={pacs_id} → Revoke PACS-only grant\n- DELETE .../assignments/{principal_id}?tenant_wide_only=true → Revoke tenant-wide grant","operationId":"revoke_role_api_v1_roles__role_id__assignments__principal_id__delete","parameters":[{"name":"role_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Role Id"}},{"name":"principal_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Principal Id"}},{"name":"app_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"description":"Revoke only the grant for this specific app. If not provided, revokes ALL grants for this role.","title":"App Id"},"description":"Revoke only the grant for this specific app. If not provided, revokes ALL grants for this role."},{"name":"tenant_wide_only","in":"query","required":false,"schema":{"type":"boolean","description":"If true, revoke only the tenant-wide grant (app_id IS NULL). Cannot be used with app_id parameter.","default":false,"title":"Tenant Wide Only"},"description":"If true, revoke only the tenant-wide grant (app_id IS NULL). Cannot be used with app_id parameter."}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/roles/{role_id}/permissions":{"get":{"tags":["Role Management"],"summary":"Get Role Permissions","description":"Get permissions assigned to a role.","operationId":"get_role_permissions_api_v1_roles__role_id__permissions_get","parameters":[{"name":"role_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Role Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/PermissionResponse"},"title":"Response Get Role Permissions Api V1 Roles  Role Id  Permissions Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]},"post":{"tags":["Role Management"],"summary":"Grant Permission To Role","description":"Grant a permission to a role.","operationId":"grant_permission_to_role_api_v1_roles__role_id__permissions_post","parameters":[{"name":"role_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Role Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PermissionGrantRequest"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/roles/{role_id}/permissions/bulk":{"post":{"tags":["Role Management"],"summary":"Bulk Grant Permissions To Role","description":"Bulk grant multiple permissions to a role.\n\nGrants up to 100 permissions in a single request.\nReturns count of granted, skipped (already assigned), and any errors.","operationId":"bulk_grant_permissions_to_role_api_v1_roles__role_id__permissions_bulk_post","parameters":[{"name":"role_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Role Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BulkPermissionGrantRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BulkPermissionGrantResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/roles/{role_id}/with-permissions":{"get":{"tags":["Role Management"],"summary":"Get Role With Permissions","description":"Get role details including all assigned permissions.","operationId":"get_role_with_permissions_api_v1_roles__role_id__with_permissions_get","parameters":[{"name":"role_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Role Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RoleWithPermissionsResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/roles/{role_id}/permissions/{permission_id}":{"delete":{"tags":["Role Management"],"summary":"Revoke Permission From Role","description":"Revoke a permission from a role.","operationId":"revoke_permission_from_role_api_v1_roles__role_id__permissions__permission_id__delete","parameters":[{"name":"role_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Role Id"}},{"name":"permission_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Permission Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/permissions":{"get":{"tags":["Permission Management"],"summary":"List Permissions","description":"List permissions with pagination, filtering and sorting (ADR-SEC-004).\n\nSupports filtering by:\n- **permission_key**: Partial match on permission key (e.g., 'pacs.study')\n- **namespace**: Filter by namespace prefix (e.g., 'pacs', 'ris', 'cp')\n- **risk_level**: Filter by risk level (LOW, MEDIUM, HIGH)\n- **is_system**: Filter system permissions (true) or custom permissions (false)\n- **status**: Filter by status (ACTIVE, DEPRECATED, DISABLED)\n\nSorting:\n- **sort_by**: permission_key, created_at, risk_level (default: permission_key)\n- **sort_order**: asc or desc (default: asc)\n\nReturns paginated results with total count for UI pagination.","operationId":"list_permissions_api_v1_permissions_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":1000,"minimum":1,"description":"Maximum number of results","default":100,"title":"Limit"},"description":"Maximum number of results"},{"name":"offset","in":"query","required":false,"schema":{"type":"integer","minimum":0,"description":"Number of records to skip","default":0,"title":"Offset"},"description":"Number of records to skip"},{"name":"permission_key","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by permission key (partial match, e.g., 'pacs.study')","title":"Permission Key"},"description":"Filter by permission key (partial match, e.g., 'pacs.study')"},{"name":"namespace","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by namespace prefix (e.g., 'pacs', 'ris', 'cp')","title":"Namespace"},"description":"Filter by namespace prefix (e.g., 'pacs', 'ris', 'cp')"},{"name":"risk_level","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by risk level (LOW, MEDIUM, HIGH)","title":"Risk Level"},"description":"Filter by risk level (LOW, MEDIUM, HIGH)"},{"name":"is_system","in":"query","required":false,"schema":{"anyOf":[{"type":"boolean"},{"type":"null"}],"description":"Filter by system permission flag","title":"Is System"},"description":"Filter by system permission flag"},{"name":"status","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by status (ACTIVE, DEPRECATED, DISABLED)","title":"Status"},"description":"Filter by status (ACTIVE, DEPRECATED, DISABLED)"},{"name":"sort_by","in":"query","required":false,"schema":{"anyOf":[{"type":"string","pattern":"^(permission_key|created_at|risk_level)$"},{"type":"null"}],"description":"Sort field: permission_key, created_at, risk_level","default":"permission_key","title":"Sort By"},"description":"Sort field: permission_key, created_at, risk_level"},{"name":"sort_order","in":"query","required":false,"schema":{"anyOf":[{"type":"string","pattern":"^(asc|desc)$"},{"type":"null"}],"description":"Sort order: asc, desc","default":"asc","title":"Sort Order"},"description":"Sort order: asc, desc"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaginatedPermissionsResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]},"post":{"tags":["Permission Management"],"summary":"Create Permission","description":"Create a new permission (ADR-SEC-004).\n\nPermissions are GLOBAL (no tenant_id). Uses namespaced permission_key.\nRequires super admin access (platform-level operation).","operationId":"create_permission_api_v1_permissions_post","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PermissionCreate"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PermissionResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/permissions/bulk":{"post":{"tags":["Permission Management"],"summary":"Bulk Create Permissions","description":"Bulk create permissions (ADR-SEC-004).\n\nCreates multiple GLOBAL permissions in a single transaction.\nSkips duplicates and reports errors without failing the entire batch.\nRequires super admin access (platform-level operation).\n\nReturns:\n    Summary of created, skipped, and errored permissions.","operationId":"bulk_create_permissions_api_v1_permissions_bulk_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BulkPermissionCreateRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/BulkPermissionCreateResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/permissions/groups":{"get":{"tags":["Permission Management"],"summary":"Get Permissions Grouped","description":"Get all permissions grouped by namespace (ADR-SEC-004).\n\nGroups permissions by the first segment of permission_key.\nExample: 'pacs.study.read' → namespace='pacs'\n\nUseful for UI to display permissions organized by application namespace.","operationId":"get_permissions_grouped_api_v1_permissions_groups_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/PermissionGroupResponse"},"type":"array","title":"Response Get Permissions Grouped Api V1 Permissions Groups Get"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/permissions/{permission_id}":{"get":{"tags":["Permission Management"],"summary":"Get Permission","description":"Get permission by ID.","operationId":"get_permission_api_v1_permissions__permission_id__get","parameters":[{"name":"permission_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Permission Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PermissionResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]},"patch":{"tags":["Permission Management"],"summary":"Update Permission","description":"Update a permission (ADR-SEC-004).\n\nRequires super admin access (platform-level operation).\n\nProduction-grade protection:\n- System permissions (is_system=True) cannot be modified\n- permission_key is immutable after creation\n- Only these fields can be updated: description, status, risk_level, is_assignable\n\nStatus lifecycle: ACTIVE → DEPRECATED → DISABLED\n- DEPRECATED: Still works but warns in logs (migration period)\n- DISABLED: Effectively blocked from authorization checks","operationId":"update_permission_api_v1_permissions__permission_id__patch","parameters":[{"name":"permission_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Permission Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PermissionUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PermissionResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]},"delete":{"tags":["Permission Management"],"summary":"Delete Permission","description":"Delete a permission (soft delete).\n\nRequires super admin access (platform-level operation).\n\nProduction-grade protection:\n- System permissions cannot be deleted\n- Permissions assigned to roles require force=true\n- Soft delete preserves audit trail\n\nArgs:\n    permission_id: UUID of permission to delete\n    force: If true, allow deleting permissions assigned to roles","operationId":"delete_permission_api_v1_permissions__permission_id__delete","parameters":[{"name":"permission_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Permission Id"}},{"name":"force","in":"query","required":false,"schema":{"type":"boolean","description":"Force delete even if assigned to roles (soft delete only)","default":false,"title":"Force"},"description":"Force delete even if assigned to roles (soft delete only)"}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/permissions/{permission_id}/roles":{"get":{"tags":["Permission Management"],"summary":"Get Permission Roles","description":"Get all roles that have this permission assigned.\n\nUseful for:\n- Impact analysis before deprecating/deleting a permission\n- Understanding permission usage across the tenant\n- Audit and compliance reporting","operationId":"get_permission_roles_api_v1_permissions__permission_id__roles_get","parameters":[{"name":"permission_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Permission Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PermissionRolesResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/invitations":{"post":{"tags":["Invitation Management"],"summary":"Create Invitation","description":"Create a new invitation.\n\nADR-SEC-004: Invitation Flow with App Selection\n- App-scoped: Provide app_ids list\n- Tenant-wide: Set is_tenant_wide=True with grant_reason (≥10 chars)\n\nThe invitation code is generated securely and can be shared with the invitee.","operationId":"create_invitation_api_v1_invitations_post","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/InvitationCreate"}}}},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/InvitationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]},"get":{"tags":["Invitation Management"],"summary":"List Invitations","description":"List invitations for current tenant.\n\nSupports filtering by status: pending, accepted, expired, revoked","operationId":"list_invitations_api_v1_invitations_get","parameters":[{"name":"status","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Status"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"default":50,"title":"Limit"}},{"name":"offset","in":"query","required":false,"schema":{"type":"integer","minimum":0,"default":0,"title":"Offset"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaginatedInvitationsResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/invitations/{invitation_id}":{"get":{"tags":["Invitation Management"],"summary":"Get Invitation","description":"Get invitation by ID.","operationId":"get_invitation_api_v1_invitations__invitation_id__get","parameters":[{"name":"invitation_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Invitation Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/InvitationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]},"delete":{"tags":["Invitation Management"],"summary":"Revoke Invitation","description":"Revoke an invitation.\n\nCan only revoke pending invitations. Accepted invitations cannot be revoked.","operationId":"revoke_invitation_api_v1_invitations__invitation_id__delete","parameters":[{"name":"invitation_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Invitation Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/invitations/validate/{code}":{"get":{"tags":["Invitation Management"],"summary":"Validate Invitation Code","description":"Validate an invitation code (public endpoint for registration flow).\n\nReturns invitation details if valid, error if invalid/expired/revoked.\nNote: This endpoint does NOT require authentication.","operationId":"validate_invitation_code_api_v1_invitations_validate__code__get","parameters":[{"name":"code","in":"path","required":true,"schema":{"type":"string","title":"Code"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/InvitationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/user/profile":{"patch":{"tags":["User Profile"],"summary":"Update Profile","description":"Update current user's profile (self-service).\n\nLimited to non-sensitive fields that users can update themselves.","operationId":"update_profile_api_v1_user_profile_patch","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ProfileUpdateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserDetailResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/audit":{"post":{"tags":["Audit"],"summary":"Emit Audit Event","description":"Emit an audit event.\n\nCreates and emits an audit event for the specified action.\nThe event is automatically enriched with request context.","operationId":"emit_audit_event_api_v1_audit_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuditEventRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuditEventResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/audit/verify":{"post":{"tags":["Audit"],"summary":"Verify Audit Event","description":"Verify audit event integrity.\n\nChecks that an audit event exists and has not been tampered with.","operationId":"verify_audit_event_api_v1_audit_verify_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuditVerifyRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuditVerifyResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/audit/query":{"post":{"tags":["Audit"],"summary":"Query Audit Events","description":"Query audit events.\n\nSearch and filter audit events. Requires admin privileges.","operationId":"query_audit_events_api_v1_audit_query_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuditQueryRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuditQueryResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/rate-limit/status/{bucket}":{"get":{"tags":["Rate Limiting"],"summary":"Get Rate Limit Status","description":"Get rate limit status for a bucket.\n\nReturns current rate limit status without consuming a request.","operationId":"get_rate_limit_status_api_v1_rate_limit_status__bucket__get","parameters":[{"name":"bucket","in":"path","required":true,"schema":{"type":"string","title":"Bucket"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RateLimitStatusResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/rate-limit/check":{"post":{"tags":["Rate Limiting"],"summary":"Check Rate Limit","description":"Check and consume rate limit for a bucket.\n\nChecks if request is allowed and consumes one from the bucket.","operationId":"check_rate_limit_api_v1_rate_limit_check_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RateLimitCheckRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RateLimitStatusResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/rate-limit/reset":{"delete":{"tags":["Rate Limiting"],"summary":"Reset Rate Limit","description":"Reset rate limit for a bucket.\n\nRequires admin privileges.","operationId":"reset_rate_limit_api_v1_rate_limit_reset_delete","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RateLimitResetRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RateLimitResetResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/revocation/token":{"post":{"tags":["Token Revocation"],"summary":"Revoke Token","description":"Revoke a specific token by JTI.\n\nAdds the token to the revocation list. The token will be rejected\nby authentication middleware until it naturally expires.","operationId":"revoke_token_api_v1_revocation_token_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TokenRevokeRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RevocationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/revocation/user":{"post":{"tags":["Token Revocation"],"summary":"Revoke User Tokens","description":"Revoke all tokens for a user.\n\nAll tokens issued to this user will be rejected until they\nnaturally expire. Use for account lockout or password reset.","operationId":"revoke_user_tokens_api_v1_revocation_user_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserRevokeRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RevocationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/revocation/session":{"post":{"tags":["Token Revocation"],"summary":"Revoke Session","description":"Revoke all tokens for a session.\n\nAll tokens from this session (based on sid claim) will be rejected.\nUse for logout or session termination.","operationId":"revoke_session_api_v1_revocation_session_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SessionRevokeRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RevocationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/api/v1/revocation/check":{"post":{"tags":["Token Revocation"],"summary":"Check Revocation","description":"Check if a token is revoked.\n\nReturns whether the token has been explicitly revoked.","operationId":"check_revocation_api_v1_revocation_check_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RevocationCheckRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RevocationCheckResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"BearerAuth":[]}]}},"/":{"get":{"summary":"Root","description":"Root endpoint with API info.","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"AuditEventInfo":{"properties":{"event_id":{"type":"string","title":"Event Id"},"event_type":{"type":"string","title":"Event Type"},"timestamp":{"type":"string","format":"date-time","title":"Timestamp"},"tenant_id":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"title":"Tenant Id"},"principal_id":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"title":"Principal Id"},"resource_type":{"type":"string","title":"Resource Type"},"resource_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Resource Id"},"action":{"type":"string","title":"Action"},"outcome":{"type":"string","title":"Outcome"},"details":{"additionalProperties":true,"type":"object","title":"Details"}},"type":"object","required":["event_id","event_type","timestamp","tenant_id","principal_id","resource_type","resource_id","action","outcome","details"],"title":"AuditEventInfo","description":"Audit event information."},"AuditEventRequest":{"properties":{"event_type":{"type":"string","title":"Event Type","description":"Event type (e.g., 'data.access', 'auth.login')"},"resource_type":{"type":"string","title":"Resource Type","description":"Resource type affected"},"resource_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Resource Id","description":"Resource ID if applicable"},"action":{"type":"string","title":"Action","description":"Action performed"},"outcome":{"type":"string","title":"Outcome","description":"Outcome: success, failure, unknown","default":"success"},"details":{"additionalProperties":true,"type":"object","title":"Details","description":"Additional details"}},"type":"object","required":["event_type","resource_type","action"],"title":"AuditEventRequest","description":"Request to emit an audit event."},"AuditEventResponse":{"properties":{"success":{"type":"boolean","title":"Success"},"event_id":{"type":"string","title":"Event Id"},"timestamp":{"type":"string","format":"date-time","title":"Timestamp"},"message":{"type":"string","title":"Message"}},"type":"object","required":["success","event_id","timestamp","message"],"title":"AuditEventResponse","description":"Response for audit event emission."},"AuditQueryRequest":{"properties":{"tenant_id":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"title":"Tenant Id","description":"Filter by tenant"},"principal_id":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"title":"Principal Id","description":"Filter by principal"},"event_type":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Event Type","description":"Filter by event type"},"resource_type":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Resource Type","description":"Filter by resource type"},"start_time":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Start Time","description":"Start of time range"},"end_time":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"End Time","description":"End of time range"},"limit":{"type":"integer","maximum":1000.0,"minimum":1.0,"title":"Limit","description":"Max results","default":100},"offset":{"type":"integer","minimum":0.0,"title":"Offset","description":"Result offset","default":0}},"type":"object","title":"AuditQueryRequest","description":"Request to query audit events."},"AuditQueryResponse":{"properties":{"events":{"items":{"$ref":"#/components/schemas/AuditEventInfo"},"type":"array","title":"Events"},"total":{"type":"integer","title":"Total"},"limit":{"type":"integer","title":"Limit"},"offset":{"type":"integer","title":"Offset"}},"type":"object","required":["events","total","limit","offset"],"title":"AuditQueryResponse","description":"Response for audit query."},"AuditVerifyRequest":{"properties":{"event_id":{"type":"string","title":"Event Id","description":"Event ID to verify"},"signature":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Signature","description":"Event signature if available"}},"type":"object","required":["event_id"],"title":"AuditVerifyRequest","description":"Request to verify audit event integrity."},"AuditVerifyResponse":{"properties":{"valid":{"type":"boolean","title":"Valid"},"event_id":{"type":"string","title":"Event Id"},"message":{"type":"string","title":"Message"},"verified_at":{"type":"string","format":"date-time","title":"Verified At"}},"type":"object","required":["valid","event_id","message","verified_at"],"title":"AuditVerifyResponse","description":"Response for audit verification."},"AuthzCheckRequest":{"properties":{"resource_type":{"type":"string","maxLength":100,"minLength":1,"title":"Resource Type","description":"Resource type to check (e.g., 'study', 'patient', 'report')"},"resource_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Resource Id","description":"Optional specific resource ID for instance-level checks"},"action":{"type":"string","maxLength":50,"minLength":1,"title":"Action","description":"Action to check (e.g., 'read', 'write', 'delete', 'share')"},"context":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Context","description":"Optional context for ABAC policy evaluation"}},"type":"object","required":["resource_type","action"],"title":"AuthzCheckRequest","description":"Request for POST /check endpoint."},"AuthzCheckResponse":{"properties":{"allowed":{"type":"boolean","title":"Allowed","description":"Whether the action is allowed"},"decision_type":{"type":"string","title":"Decision Type","description":"Decision type: ALLOW, DENY, or ALLOW_WITH_OBLIGATIONS"},"reason_codes":{"items":{"type":"string"},"type":"array","title":"Reason Codes","description":"Reason codes explaining the decision"},"decision_id":{"type":"string","title":"Decision Id","description":"Unique decision ID for audit trail","default":""},"cached":{"type":"boolean","title":"Cached","description":"Whether this was a cached decision","default":false},"obligations":{"items":{"additionalProperties":true,"type":"object"},"type":"array","title":"Obligations","description":"Obligations that must be fulfilled (if ALLOW_WITH_OBLIGATIONS)"}},"type":"object","required":["allowed","decision_type"],"title":"AuthzCheckResponse","description":"Response for POST /check endpoint."},"BulkAuthzCheckRequest":{"properties":{"checks":{"items":{"$ref":"#/components/schemas/AuthzCheckRequest"},"type":"array","maxItems":100,"minItems":1,"title":"Checks","description":"List of authorization checks to perform"}},"type":"object","required":["checks"],"title":"BulkAuthzCheckRequest","description":"Request for bulk authorization checks."},"BulkAuthzCheckResponse":{"properties":{"results":{"items":{"$ref":"#/components/schemas/AuthzCheckResponse"},"type":"array","title":"Results","description":"Results in same order as requests"}},"type":"object","required":["results"],"title":"BulkAuthzCheckResponse","description":"Response for bulk authorization checks."},"BulkPermissionCreateRequest":{"properties":{"permissions":{"items":{"$ref":"#/components/schemas/PermissionCreate"},"type":"array","maxItems":100,"minItems":1,"title":"Permissions","description":"List of permissions to create"}},"type":"object","required":["permissions"],"title":"BulkPermissionCreateRequest","description":"Bulk create permissions request."},"BulkPermissionCreateResponse":{"properties":{"created":{"type":"integer","title":"Created"},"skipped":{"type":"integer","title":"Skipped"},"errors":{"items":{"type":"string"},"type":"array","title":"Errors"},"permissions":{"items":{"$ref":"#/components/schemas/PermissionResponse"},"type":"array","title":"Permissions"}},"type":"object","required":["created","skipped"],"title":"BulkPermissionCreateResponse","description":"Response for bulk permission creation."},"BulkPermissionGrantRequest":{"properties":{"permission_ids":{"items":{"type":"string","format":"uuid"},"type":"array","maxItems":100,"minItems":1,"title":"Permission Ids"}},"type":"object","required":["permission_ids"],"title":"BulkPermissionGrantRequest","description":"Bulk grant permissions to role request."},"BulkPermissionGrantResponse":{"properties":{"granted":{"type":"integer","title":"Granted"},"skipped":{"type":"integer","title":"Skipped"},"errors":{"items":{"type":"string"},"type":"array","title":"Errors"}},"type":"object","required":["granted","skipped"],"title":"BulkPermissionGrantResponse","description":"Response for bulk permission grant."},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"IntrospectionResponse":{"properties":{"active":{"type":"boolean","title":"Active","description":"Whether token is active"},"exp":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Exp","description":"Expiration timestamp"},"tenant_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Tenant Id","description":"Tenant ID"},"email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Email","description":"User email"},"roles":{"items":{"type":"string"},"type":"array","title":"Roles","description":"User roles"},"subject":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Subject","description":"Token subject"}},"type":"object","required":["active"],"title":"IntrospectionResponse","description":"Token introspection response."},"InvitationCreate":{"properties":{"email":{"anyOf":[{"type":"string","maxLength":255},{"type":"null"}],"title":"Email","description":"Optional email (open invitation if not set)"},"role_id":{"type":"string","format":"uuid","title":"Role Id","description":"Role to assign upon acceptance"},"app_ids":{"anyOf":[{"items":{"type":"string","format":"uuid"},"type":"array"},{"type":"null"}],"title":"App Ids","description":"Apps to grant access to. Required unless is_tenant_wide=True."},"is_tenant_wide":{"type":"boolean","title":"Is Tenant Wide","description":"If True, grant applies to all apps. Requires grant_reason.","default":false},"grant_reason":{"anyOf":[{"type":"string","maxLength":500,"minLength":10},{"type":"null"}],"title":"Grant Reason","description":"Required for tenant-wide grants. Explains why broad access is needed."},"expires_in_days":{"type":"integer","maximum":90.0,"minimum":1.0,"title":"Expires In Days","description":"Days until invitation expires (1-90)","default":7}},"type":"object","required":["role_id"],"title":"InvitationCreate","description":"Create invitation request.\n\nADR-SEC-004: Invitation Flow with App Selection\n- Admin specifies role and apps user will have access to\n- App-scoped: Provide app_ids list\n- Tenant-wide: Set is_tenant_wide=True with grant_reason"},"InvitationResponse":{"properties":{"id":{"type":"string","format":"uuid","title":"Id"},"tenant_id":{"type":"string","format":"uuid","title":"Tenant Id"},"code":{"type":"string","title":"Code"},"email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Email"},"role_id":{"type":"string","format":"uuid","title":"Role Id"},"role_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Role Name"},"app_ids":{"anyOf":[{"items":{"type":"string","format":"uuid"},"type":"array"},{"type":"null"}],"title":"App Ids"},"is_tenant_wide":{"type":"boolean","title":"Is Tenant Wide"},"grant_reason":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Grant Reason"},"status":{"type":"string","title":"Status"},"expires_at":{"type":"string","format":"date-time","title":"Expires At"},"created_by":{"type":"string","format":"uuid","title":"Created By"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"accepted_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Accepted At"},"accepted_by":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"title":"Accepted By"}},"type":"object","required":["id","tenant_id","code","email","role_id","app_ids","is_tenant_wide","grant_reason","status","expires_at","created_by","created_at","accepted_at","accepted_by"],"title":"InvitationResponse","description":"Invitation response."},"LoginRequest":{"properties":{"username":{"type":"string","maxLength":255,"minLength":1,"title":"Username","description":"Username or email"},"password":{"type":"string","minLength":1,"title":"Password","description":"User password"},"scope":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Scope","description":"OAuth scope (default: openid profile email)"}},"type":"object","required":["username","password"],"title":"LoginRequest","description":"Direct Access Grant login request."},"LogoutRequest":{"properties":{"refresh_token":{"type":"string","title":"Refresh Token","description":"Refresh token to revoke"}},"type":"object","required":["refresh_token"],"title":"LogoutRequest","description":"Request body for logout."},"LogoutResponse":{"properties":{"status":{"type":"string","title":"Status","description":"Logout status","default":"logged_out"}},"type":"object","title":"LogoutResponse","description":"Logout response."},"MyPermissionsResponse":{"properties":{"principal_id":{"type":"string","format":"uuid","title":"Principal Id","description":"Current user's principal ID"},"tenant_id":{"type":"string","format":"uuid","title":"Tenant Id","description":"Current tenant ID"},"realm_roles":{"items":{"type":"string"},"type":"array","title":"Realm Roles","description":"Realm-level roles from IdP (e.g., 'admin', 'user')"},"roles":{"items":{"$ref":"#/components/schemas/RoleInfo"},"type":"array","title":"Roles","description":"Database roles assigned to user in this tenant"},"permissions":{"items":{"$ref":"#/components/schemas/PermissionInfo"},"type":"array","title":"Permissions","description":"Effective permissions (from roles + direct grants)"}},"type":"object","required":["principal_id","tenant_id"],"title":"MyPermissionsResponse","description":"Response for GET /me/permissions endpoint."},"PaginatedInvitationsResponse":{"properties":{"items":{"items":{"$ref":"#/components/schemas/InvitationResponse"},"type":"array","title":"Items"},"total":{"type":"integer","title":"Total"},"limit":{"type":"integer","title":"Limit"},"offset":{"type":"integer","title":"Offset"},"has_more":{"type":"boolean","title":"Has More"}},"type":"object","required":["items","total","limit","offset","has_more"],"title":"PaginatedInvitationsResponse","description":"Paginated invitations response."},"PaginatedPermissionsResponse":{"properties":{"items":{"items":{"$ref":"#/components/schemas/PermissionResponse"},"type":"array","title":"Items"},"total":{"type":"integer","title":"Total"},"limit":{"type":"integer","title":"Limit"},"offset":{"type":"integer","title":"Offset"},"has_more":{"type":"boolean","title":"Has More"}},"type":"object","required":["items","total","limit","offset","has_more"],"title":"PaginatedPermissionsResponse","description":"Paginated permissions response with total count."},"PaginatedRolesResponse":{"properties":{"items":{"items":{"$ref":"#/components/schemas/RoleResponse"},"type":"array","title":"Items"},"total":{"type":"integer","title":"Total"},"limit":{"type":"integer","title":"Limit"},"offset":{"type":"integer","title":"Offset"},"has_more":{"type":"boolean","title":"Has More"}},"type":"object","required":["items","total","limit","offset","has_more"],"title":"PaginatedRolesResponse","description":"Paginated roles response with total count."},"PaginatedRolesWithPermissionsResponse":{"properties":{"items":{"items":{"$ref":"#/components/schemas/RoleWithPermissionsListItem"},"type":"array","title":"Items"},"total":{"type":"integer","title":"Total"},"limit":{"type":"integer","title":"Limit"},"offset":{"type":"integer","title":"Offset"},"has_more":{"type":"boolean","title":"Has More"}},"type":"object","required":["items","total","limit","offset","has_more"],"title":"PaginatedRolesWithPermissionsResponse","description":"Paginated roles response including permissions for each role."},"PaginatedTenantsResponse":{"properties":{"items":{"items":{"$ref":"#/components/schemas/TenantResponse"},"type":"array","title":"Items"},"total":{"type":"integer","title":"Total","description":"Total count of matching records"},"limit":{"type":"integer","title":"Limit","description":"Items per page"},"offset":{"type":"integer","title":"Offset","description":"Current offset"},"has_more":{"type":"boolean","title":"Has More","description":"Whether more records exist"}},"type":"object","required":["items","total","limit","offset","has_more"],"title":"PaginatedTenantsResponse","description":"Paginated tenants response."},"PaginatedUsersResponse":{"properties":{"items":{"items":{"$ref":"#/components/schemas/UserResponse"},"type":"array","title":"Items"},"total":{"type":"integer","title":"Total"},"limit":{"type":"integer","title":"Limit"},"offset":{"type":"integer","title":"Offset"},"has_more":{"type":"boolean","title":"Has More"}},"type":"object","required":["items","total","limit","offset","has_more"],"title":"PaginatedUsersResponse","description":"Paginated users response with total count."},"PermissionCreate":{"properties":{"permission_key":{"type":"string","maxLength":128,"minLength":5,"pattern":"^[a-z]+(\\.[a-z0-9_]+){2,}$","title":"Permission Key","description":"Namespaced permission key (e.g., 'pacs.study.read')"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"risk_level":{"type":"string","pattern":"^(LOW|MEDIUM|HIGH)$","title":"Risk Level","description":"Risk level: LOW, MEDIUM, HIGH","default":"MEDIUM"},"is_assignable":{"type":"boolean","title":"Is Assignable","description":"Whether this permission can be assigned to roles","default":true}},"type":"object","required":["permission_key"],"title":"PermissionCreate","description":"Create permission request (ADR-SEC-004).\n\nPermission key must follow the namespace format:\n{namespace}.{resource}.{action} (e.g., 'pacs.study.read')\n\nValid namespaces: cp, dp, pacs, ris, viewer, shared, platform"},"PermissionGrantRequest":{"properties":{"permission_id":{"type":"string","format":"uuid","title":"Permission Id"}},"type":"object","required":["permission_id"],"title":"PermissionGrantRequest","description":"Grant permission to role request."},"PermissionGroupResponse":{"properties":{"namespace":{"type":"string","title":"Namespace","description":"Permission namespace (e.g., 'pacs', 'ris', 'cp')"},"permissions":{"items":{"$ref":"#/components/schemas/PermissionResponse"},"type":"array","title":"Permissions"},"count":{"type":"integer","title":"Count","description":"Number of permissions in this namespace"}},"type":"object","required":["namespace","permissions","count"],"title":"PermissionGroupResponse","description":"Permissions grouped by namespace (ADR-SEC-004).\n\nNamespace is the first segment of permission_key.\nExample: 'pacs.study.read' → namespace='pacs'"},"PermissionInfo":{"properties":{"resource":{"type":"string","title":"Resource","description":"Resource type (e.g., 'study', 'patient')"},"action":{"type":"string","title":"Action","description":"Action (e.g., 'read', 'write', 'delete')"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description","description":"Human-readable description"}},"type":"object","required":["resource","action"],"title":"PermissionInfo","description":"Permission information."},"PermissionResponse":{"properties":{"id":{"type":"string","format":"uuid","title":"Id"},"permission_key":{"type":"string","title":"Permission Key","description":"Namespaced permission key (e.g., 'pacs.study.read')"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"status":{"type":"string","title":"Status","description":"ACTIVE, DEPRECATED, DISABLED","default":"ACTIVE"},"risk_level":{"type":"string","title":"Risk Level","description":"LOW, MEDIUM, HIGH","default":"MEDIUM"},"is_system":{"type":"boolean","title":"Is System","description":"System-defined permission","default":true},"is_assignable":{"type":"boolean","title":"Is Assignable","description":"Can be assigned to roles","default":true},"introduced_in_version":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Introduced In Version","description":"Version when introduced"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"}},"type":"object","required":["id","permission_key","created_at"],"title":"PermissionResponse","description":"Permission response (ADR-SEC-004).\n\nPermissions are GLOBAL - no tenant_id.\nUses permission_key format: {namespace}.{resource}.{action}"},"PermissionRolesResponse":{"properties":{"permission_id":{"type":"string","format":"uuid","title":"Permission Id"},"permission_key":{"type":"string","title":"Permission Key","description":"Namespaced permission key"},"role_count":{"type":"integer","title":"Role Count"},"roles":{"items":{"$ref":"#/components/schemas/RoleResponse"},"type":"array","title":"Roles"}},"type":"object","required":["permission_id","permission_key","role_count","roles"],"title":"PermissionRolesResponse","description":"Response showing which roles have a permission (ADR-SEC-004)."},"PermissionUpdate":{"properties":{"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"status":{"anyOf":[{"type":"string","pattern":"^(ACTIVE|DEPRECATED|DISABLED)$"},{"type":"null"}],"title":"Status","description":"Permission status: ACTIVE, DEPRECATED, DISABLED"},"risk_level":{"anyOf":[{"type":"string","pattern":"^(LOW|MEDIUM|HIGH)$"},{"type":"null"}],"title":"Risk Level","description":"Risk level: LOW, MEDIUM, HIGH"},"is_assignable":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Is Assignable","description":"Whether this permission can be assigned"}},"type":"object","title":"PermissionUpdate","description":"Update permission request (ADR-SEC-004).\n\nNote: permission_key is immutable after creation.\nOnly description, status, and risk_level can be updated."},"ProfileUpdateRequest":{"properties":{"name":{"anyOf":[{"type":"string","maxLength":255},{"type":"null"}],"title":"Name"}},"type":"object","title":"ProfileUpdateRequest","description":"Self-service profile update request (limited fields)."},"RateLimitCheckRequest":{"properties":{"bucket":{"type":"string","title":"Bucket","description":"Rate limit bucket name"},"limit":{"type":"integer","maximum":10000.0,"minimum":1.0,"title":"Limit","description":"Max requests in window","default":100},"window_seconds":{"type":"integer","maximum":86400.0,"minimum":1.0,"title":"Window Seconds","description":"Window in seconds","default":60}},"type":"object","required":["bucket"],"title":"RateLimitCheckRequest","description":"Request for rate limit check."},"RateLimitResetRequest":{"properties":{"bucket":{"type":"string","title":"Bucket","description":"Rate limit bucket to reset"}},"type":"object","required":["bucket"],"title":"RateLimitResetRequest","description":"Request for rate limit reset."},"RateLimitResetResponse":{"properties":{"success":{"type":"boolean","title":"Success"},"message":{"type":"string","title":"Message"},"bucket":{"type":"string","title":"Bucket"}},"type":"object","required":["success","message","bucket"],"title":"RateLimitResetResponse","description":"Response for rate limit reset."},"RateLimitStatusResponse":{"properties":{"bucket":{"type":"string","title":"Bucket","description":"Rate limit bucket name"},"allowed":{"type":"boolean","title":"Allowed","description":"Whether request is allowed"},"remaining":{"type":"integer","title":"Remaining","description":"Remaining requests in window"},"limit":{"type":"integer","title":"Limit","description":"Maximum requests in window"},"reset_at":{"type":"number","title":"Reset At","description":"Window reset timestamp"},"retry_after":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Retry After","description":"Seconds until request allowed (if rate limited)"}},"type":"object","required":["bucket","allowed","remaining","limit","reset_at"],"title":"RateLimitStatusResponse","description":"Rate limit status response."},"RefreshTokenRequest":{"properties":{"refresh_token":{"type":"string","title":"Refresh Token","description":"Valid refresh token"}},"type":"object","required":["refresh_token"],"title":"RefreshTokenRequest","description":"Request body for token refresh."},"RegisterRequest":{"properties":{"email":{"type":"string","pattern":"^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$","title":"Email","description":"Email address"},"username":{"type":"string","maxLength":50,"minLength":3,"pattern":"^[a-zA-Z0-9_.-]+$","title":"Username","description":"Username (alphanumeric, underscore, dot, dash)"},"password":{"type":"string","maxLength":128,"minLength":12,"title":"Password","description":"Password (min 12 chars, requires mixed case, number, special char)"},"first_name":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"First Name","description":"First name"},"last_name":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Last Name","description":"Last name"},"tenant_id":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"title":"Tenant Id","description":"Tenant to join (if allowed)"},"invitation_code":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Invitation Code","description":"Invitation code for tenant"}},"type":"object","required":["email","username","password"],"title":"RegisterRequest","description":"User registration request."},"RegisterResponse":{"properties":{"success":{"type":"boolean","title":"Success","description":"Registration succeeded"},"message":{"type":"string","title":"Message","description":"Status message"},"user_id":{"type":"string","title":"User Id","description":"Keycloak user ID"},"email":{"type":"string","title":"Email","description":"Registered email"},"username":{"type":"string","title":"Username","description":"Registered username"},"email_verification_required":{"type":"boolean","title":"Email Verification Required","description":"Whether email verification is required","default":true}},"type":"object","required":["success","message","user_id","email","username"],"title":"RegisterResponse","description":"Registration response."},"RevocationCheckRequest":{"properties":{"token_or_jti":{"type":"string","title":"Token Or Jti","description":"Token or JTI to check"}},"type":"object","required":["token_or_jti"],"title":"RevocationCheckRequest","description":"Request to check if a token is revoked."},"RevocationCheckResponse":{"properties":{"is_revoked":{"type":"boolean","title":"Is Revoked"},"reason":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Reason"},"revoked_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Revoked At"}},"type":"object","required":["is_revoked"],"title":"RevocationCheckResponse","description":"Response for revocation check."},"RevocationResponse":{"properties":{"success":{"type":"boolean","title":"Success"},"message":{"type":"string","title":"Message"},"revoked_key":{"type":"string","title":"Revoked Key"}},"type":"object","required":["success","message","revoked_key"],"title":"RevocationResponse","description":"Response for revocation operations."},"RoleAssignmentCreate":{"properties":{"principal_id":{"type":"string","format":"uuid","title":"Principal Id","description":"User/principal to assign the role to"},"app_id":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"title":"App Id","description":"App constraint for app-scoped grants. Required unless is_tenant_wide=True."},"is_tenant_wide":{"type":"boolean","title":"Is Tenant Wide","description":"If True, grant applies to all apps. Requires grant_reason.","default":false},"grant_reason":{"anyOf":[{"type":"string","maxLength":500,"minLength":10},{"type":"null"}],"title":"Grant Reason","description":"Required for tenant-wide grants. Explains why broad access is needed."},"expires_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Expires At","description":"Optional expiration timestamp for the grant."}},"type":"object","required":["principal_id"],"title":"RoleAssignmentCreate","description":"Create role assignment request.\n\nADR-SEC-004: Supports app-scoped and tenant-wide grants.\nNote: role_id is taken from URL path parameter (RESTful design).\n\n- App-scoped: Set app_id to the target application UUID\n- Tenant-wide: Set is_tenant_wide=True with grant_reason (≥10 chars)"},"RoleAssignmentResponse":{"properties":{"principal_id":{"type":"string","format":"uuid","title":"Principal Id"},"role_id":{"type":"string","format":"uuid","title":"Role Id"},"tenant_id":{"type":"string","format":"uuid","title":"Tenant Id"},"grant_tenant_id":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"title":"Grant Tenant Id","description":"Tenant where the grant is effective (cross-tenant MSP model)."},"app_id":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"title":"App Id","description":"App constraint (None for tenant-wide grants)."},"is_tenant_wide":{"type":"boolean","title":"Is Tenant Wide","description":"True if grant applies to all apps.","default":false},"grant_reason":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Grant Reason","description":"Reason for tenant-wide access (audit trail)."},"granted_at":{"type":"string","format":"date-time","title":"Granted At"},"granted_by":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"title":"Granted By"},"expires_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Expires At"}},"type":"object","required":["principal_id","role_id","tenant_id","granted_at","granted_by","expires_at"],"title":"RoleAssignmentResponse","description":"Role assignment response.\n\nADR-SEC-004: Includes app-scoping information."},"RoleCreate":{"properties":{"name":{"type":"string","maxLength":100,"minLength":1,"title":"Name"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"is_system":{"type":"boolean","title":"Is System","default":false}},"type":"object","required":["name"],"title":"RoleCreate","description":"Create role request."},"RoleHierarchyNode":{"properties":{"id":{"type":"string","format":"uuid","title":"Id"},"name":{"type":"string","title":"Name"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"is_system":{"type":"boolean","title":"Is System"},"depth":{"type":"integer","title":"Depth"},"children":{"items":{"$ref":"#/components/schemas/RoleHierarchyNode"},"type":"array","title":"Children"}},"type":"object","required":["id","name","description","is_system","depth"],"title":"RoleHierarchyNode","description":"Node in role hierarchy tree."},"RoleInfo":{"properties":{"id":{"type":"string","format":"uuid","title":"Id","description":"Role UUID"},"name":{"type":"string","title":"Name","description":"Role name"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description","description":"Role description"},"is_system":{"type":"boolean","title":"Is System","description":"Whether this is a system role","default":false}},"type":"object","required":["id","name"],"title":"RoleInfo","description":"Role information."},"RoleResponse":{"properties":{"id":{"type":"string","format":"uuid","title":"Id"},"name":{"type":"string","title":"Name"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"is_system":{"type":"boolean","title":"Is System"},"status":{"type":"string","title":"Status","default":"active"},"tenant_id":{"type":"string","format":"uuid","title":"Tenant Id"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"},"deleted_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Deleted At"},"deleted_by":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"title":"Deleted By"}},"type":"object","required":["id","name","description","is_system","tenant_id","created_at","updated_at"],"title":"RoleResponse","description":"Role response."},"RoleUpdate":{"properties":{"name":{"anyOf":[{"type":"string","maxLength":100,"minLength":1},{"type":"null"}],"title":"Name"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"}},"type":"object","title":"RoleUpdate","description":"Update role request."},"RoleWithPermissionsListItem":{"properties":{"id":{"type":"string","format":"uuid","title":"Id"},"name":{"type":"string","title":"Name"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"is_system":{"type":"boolean","title":"Is System"},"status":{"type":"string","title":"Status","default":"active"},"tenant_id":{"type":"string","format":"uuid","title":"Tenant Id"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"},"deleted_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Deleted At"},"permissions":{"items":{"$ref":"#/components/schemas/PermissionResponse"},"type":"array","title":"Permissions"},"permission_count":{"type":"integer","title":"Permission Count","default":0}},"type":"object","required":["id","name","description","is_system","tenant_id","created_at","updated_at"],"title":"RoleWithPermissionsListItem","description":"Role with permissions for list endpoint."},"RoleWithPermissionsResponse":{"properties":{"id":{"type":"string","format":"uuid","title":"Id"},"name":{"type":"string","title":"Name"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"is_system":{"type":"boolean","title":"Is System"},"tenant_id":{"type":"string","format":"uuid","title":"Tenant Id"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"},"permissions":{"items":{"$ref":"#/components/schemas/PermissionResponse"},"type":"array","title":"Permissions"},"permission_count":{"type":"integer","title":"Permission Count","default":0}},"type":"object","required":["id","name","description","is_system","tenant_id","created_at","updated_at"],"title":"RoleWithPermissionsResponse","description":"Role response including permissions."},"SessionRevokeRequest":{"properties":{"session_id":{"type":"string","title":"Session Id","description":"Session ID to revoke"},"user_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Id","description":"User ID for tracking"},"reason":{"type":"string","title":"Reason","description":"Revocation reason","default":"session_logout"},"expires_in":{"type":"integer","maximum":86400.0,"minimum":60.0,"title":"Expires In","description":"Token TTL","default":3600}},"type":"object","required":["session_id"],"title":"SessionRevokeRequest","description":"Request to revoke tokens for a session."},"TenantCreate":{"properties":{"name":{"type":"string","maxLength":255,"minLength":1,"title":"Name"},"slug":{"type":"string","maxLength":100,"minLength":1,"pattern":"^[a-z0-9-]+$","title":"Slug"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"entitlements":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Entitlements"},"settings":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Settings"}},"type":"object","required":["name","slug"],"title":"TenantCreate","description":"Create tenant request."},"TenantResponse":{"properties":{"id":{"type":"string","format":"uuid","title":"Id"},"name":{"type":"string","title":"Name"},"slug":{"type":"string","title":"Slug"},"status":{"type":"string","title":"Status"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"entitlements":{"additionalProperties":true,"type":"object","title":"Entitlements"},"settings":{"additionalProperties":true,"type":"object","title":"Settings"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"}},"type":"object","required":["id","name","slug","status","created_at"],"title":"TenantResponse","description":"Tenant response."},"TenantUpdate":{"properties":{"name":{"anyOf":[{"type":"string","maxLength":255,"minLength":1},{"type":"null"}],"title":"Name"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"entitlements":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Entitlements"},"settings":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Settings"}},"type":"object","title":"TenantUpdate","description":"Update tenant request."},"TokenResponse":{"properties":{"access_token":{"type":"string","title":"Access Token","description":"JWT access token"},"refresh_token":{"type":"string","title":"Refresh Token","description":"Refresh token for renewal"},"expires_in":{"type":"integer","title":"Expires In","description":"Token lifetime in seconds"},"token_type":{"type":"string","title":"Token Type","description":"Token type","default":"Bearer"},"scope":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Scope","description":"Granted scopes"},"id_token":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Id Token","description":"OIDC ID token"}},"type":"object","required":["access_token","refresh_token","expires_in"],"title":"TokenResponse","description":"Token response from IdP."},"TokenRevokeRequest":{"properties":{"token_or_jti":{"type":"string","title":"Token Or Jti","description":"Token or JTI to revoke"},"reason":{"type":"string","title":"Reason","description":"Revocation reason","default":"admin_revocation"},"expires_in":{"type":"integer","maximum":86400.0,"minimum":60.0,"title":"Expires In","description":"Token TTL in seconds","default":3600},"user_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"User Id","description":"User ID for tracking"}},"type":"object","required":["token_or_jti"],"title":"TokenRevokeRequest","description":"Request to revoke a token."},"UserCreate":{"properties":{"email":{"type":"string","maxLength":255,"minLength":1,"title":"Email"},"username":{"anyOf":[{"type":"string","maxLength":50,"minLength":3},{"type":"null"}],"title":"Username","description":"Username for Keycloak (defaults to email)"},"password":{"anyOf":[{"type":"string","maxLength":128,"minLength":8},{"type":"null"}],"title":"Password","description":"Password for Keycloak user"},"first_name":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"First Name","description":"User's first name"},"last_name":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Last Name","description":"User's last name"},"name":{"anyOf":[{"type":"string","maxLength":255},{"type":"null"}],"title":"Name","description":"Display name (falls back to first_name + last_name)"},"idp_issuer":{"anyOf":[{"type":"string","maxLength":500},{"type":"null"}],"title":"Idp Issuer","description":"Identity provider issuer URL (auto-set for Keycloak)"},"idp_subject":{"anyOf":[{"type":"string","maxLength":500},{"type":"null"}],"title":"Idp Subject","description":"User ID at the IdP (auto-set for Keycloak)"},"role_id":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"title":"Role Id","description":"Optional role to assign in current tenant"}},"type":"object","required":["email"],"title":"UserCreate","description":"Create user request - creates user in Keycloak and identity mapping in DB.\n\nWhen keycloak_admin is available:\n- Creates user in Keycloak with password\n- Creates identity mapping in DB with Keycloak's subject ID\n\nWhen keycloak_admin is NOT available (fallback):\n- Requires idp_issuer and idp_subject to be provided\n- Only creates identity mapping in DB"},"UserDetailResponse":{"properties":{"principal_id":{"type":"string","format":"uuid","title":"Principal Id"},"email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Email"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"},"idp_issuer":{"type":"string","title":"Idp Issuer"},"idp_subject":{"type":"string","title":"Idp Subject"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"last_seen_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Seen At"},"roles":{"items":{"$ref":"#/components/schemas/RoleResponse"},"type":"array","title":"Roles"},"tenant_ids":{"items":{"type":"string","format":"uuid"},"type":"array","title":"Tenant Ids","description":"Tenants user belongs to"}},"type":"object","required":["principal_id","email","name","idp_issuer","idp_subject","created_at","last_seen_at"],"title":"UserDetailResponse","description":"Detailed user response including roles and tenant membership."},"UserInfoResponse":{"properties":{"sub":{"type":"string","title":"Sub","description":"Subject (user ID)"},"email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Email","description":"User email"},"email_verified":{"type":"boolean","title":"Email Verified","description":"Email verified","default":false},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name","description":"Full name"},"given_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Given Name","description":"First name"},"family_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Family Name","description":"Last name"},"preferred_username":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Preferred Username","description":"Username"},"tenant_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Tenant Id","description":"Tenant ID"},"roles":{"items":{"type":"string"},"type":"array","title":"Roles","description":"User roles"}},"type":"object","required":["sub"],"title":"UserInfoResponse","description":"Userinfo response from IdP."},"UserProfileResponse":{"properties":{"access_token":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Access Token","description":"JWT access token"},"refresh_token":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Refresh Token","description":"Refresh token"},"expires_in":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Expires In","description":"Token lifetime in seconds"},"token_type":{"type":"string","title":"Token Type","description":"Token type","default":"Bearer"},"id_token":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Id Token","description":"OIDC ID token"},"sub":{"type":"string","title":"Sub","description":"Subject (IdP user ID)"},"email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Email","description":"User email"},"email_verified":{"type":"boolean","title":"Email Verified","description":"Email verified","default":false},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name","description":"Full name"},"given_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Given Name","description":"First name"},"family_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Family Name","description":"Last name"},"preferred_username":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Preferred Username","description":"Username"},"principal_id":{"type":"string","format":"uuid","title":"Principal Id","description":"Internal principal ID"},"tenant_id":{"anyOf":[{"type":"string","format":"uuid"},{"type":"null"}],"title":"Tenant Id","description":"Tenant ID"},"roles":{"items":{"type":"string"},"type":"array","title":"Roles","description":"User roles"},"permissions":{"items":{"type":"string"},"type":"array","title":"Permissions","description":"User permissions"},"authenticated_at":{"type":"string","format":"date-time","title":"Authenticated At","description":"Authentication timestamp"}},"type":"object","required":["sub","principal_id","authenticated_at"],"title":"UserProfileResponse","description":"Complete user profile - used by both /login and /me.\n\nFor /login: includes tokens\nFor /me: tokens are null"},"UserResponse":{"properties":{"principal_id":{"type":"string","format":"uuid","title":"Principal Id"},"email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Email"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"},"idp_issuer":{"type":"string","title":"Idp Issuer"},"idp_subject":{"type":"string","title":"Idp Subject"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"last_seen_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Last Seen At"}},"type":"object","required":["principal_id","email","name","idp_issuer","idp_subject","created_at","last_seen_at"],"title":"UserResponse","description":"User (principal identity) response."},"UserRevokeRequest":{"properties":{"user_id":{"type":"string","title":"User Id","description":"User ID to revoke tokens for"},"reason":{"type":"string","title":"Reason","description":"Revocation reason","default":"admin_revocation"},"expires_in":{"type":"integer","maximum":86400.0,"minimum":60.0,"title":"Expires In","description":"Token TTL","default":3600}},"type":"object","required":["user_id"],"title":"UserRevokeRequest","description":"Request to revoke all tokens for a user."},"UserRolesResponse":{"properties":{"principal_id":{"type":"string","format":"uuid","title":"Principal Id","description":"User's principal ID"},"roles":{"items":{"$ref":"#/components/schemas/RoleResponse"},"type":"array","title":"Roles","description":"Roles assigned to user"},"count":{"type":"integer","title":"Count","description":"Number of roles assigned"}},"type":"object","required":["principal_id","roles","count"],"title":"UserRolesResponse","description":"User roles response with metadata.\n\nProduction-grade response wrapping roles in an object for extensibility."},"UserUpdate":{"properties":{"email":{"anyOf":[{"type":"string","maxLength":255},{"type":"null"}],"title":"Email"},"first_name":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"First Name"},"last_name":{"anyOf":[{"type":"string","maxLength":100},{"type":"null"}],"title":"Last Name"},"name":{"anyOf":[{"type":"string","maxLength":255},{"type":"null"}],"title":"Name","description":"Display name"},"enabled":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Enabled","description":"Enable/disable user account in Keycloak"}},"type":"object","title":"UserUpdate","description":"Update user request - syncs with both Keycloak and DB."},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"BearerAuth":{"type":"http","scheme":"bearer","bearerFormat":"JWT","description":"Enter your JWT token from /api/v1/auth/login"}}}}